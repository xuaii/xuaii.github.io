# AI è‡ªç„ | åˆ†ç¦»è®¡ç®—-é‡‡é›†-æ§åˆ¶


ç”±äºæœ¬æœºéœ€è¦è¿è¡Œæ¸¸æˆè¿›ç¨‹ï¼Œå†é¢å¤–è¿è¡Œç¥ç»ç½‘ç»œï¼Œè¿™æ ·åšéå¸¸å·ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸€å°é¢å¤–çš„è®¡ç®—æœºæ¥æ¨ç†ï¼ˆåœ¨ç½‘å§ç›´æ¥å¼€ä¸¤å°ç”µè„‘ğŸ¤¡ï¼‰
ç°åœ¨æœ‰ä¸¤ç§æ•°æ®ä¼ è¾“çš„æ–¹æ¡ˆï¼š
### ä½¿ç”¨é‡‡é›†å¡
èƒ½é‡‡é›†é«˜å¸§ç‡ç”»é¢çš„é‡‡é›†å¡å”®ä»·å·²ç»è¶…è¿‡1000RMBäº†ï¼Œæ‰€ä»¥å¾ˆä¸åˆ’ç®—
å°†æ¸¸æˆä¸»æœºè®°ä¸º Aï¼Œæ¨ç†ä¸»æœºè®°ä¸º Bï¼Œè¯¥æ–¹æ¡ˆï¼ŒA åªéœ€è¦è¿è¡Œä¸€ä¸ªæ§åˆ¶é¼ æ ‡ç§»åŠ¨çš„å°ç¨‹åºï¼ˆå‡ ä¹æ²¡æœ‰æ¶ˆè€—ï¼Œå¯ä»¥ç›´æ¥çº¯ Pythonå®ç°ï¼‰ï¼Œä¸»æœº A éœ€è¦æ•è·é‡‡é›†å¡çš„è§†é¢‘ï¼Œå¹¶ä¸”è¿›è¡Œæ¨ç†ï¼Œå°†ç›®æ ‡åˆ—è¡¨æ•°æ®é€šè¿‡ TCP/UDP ä¼ è¾“åˆ°ä¸»æœºAã€‚ä¸¤å°ä¸»æœºéœ€è¦é€šè¿‡**é‡‡é›†å¡**å’Œ**RJ45**è¿æ¥

### è¿›ç¨‹é—´é€šä¿¡çš„æ–¹å¼
ä¼˜ç‚¹æ˜¯æˆæœ¬ä½ï¼Œåªç”¨è¿æ¥ä¸€æ ¹ç½‘çº¿ï¼Œç¼ºç‚¹æ˜¯é€Ÿåº¦å¯èƒ½ä¼šæ…¢ï¼‰
è¯¥æ–¹æ³•åœ¨ä¸»æœºAè¿è¡Œ**å±å¹•æ•è·å’Œé¼ æ ‡æ›´æ–°**è¿›ç¨‹ï¼Œåœ¨ä¸»æœºBè¿è¡Œæ¨ç†è¿›ç¨‹

A->B : å‰ªè£åçš„ cv::Mat (320 x 320)
B->A : é¼ æ ‡æ§åˆ¶æ•°æ®
ä»¥ 90 fpsçš„æ¨ç†é€Ÿåº¦æ¥è®¡ç®—
$$
data = \frac{90  \times 320 \times 320 \times 24}{8} =  27,648,000(B/s)=27,000(KB/s) = 26.4(MB/s)
$$
æ‰€ä»¥è¿›ç¨‹é—´ ä»¥ç½‘çº¿è¿æ¥ ä½¿ç”¨UDP é€šä¿¡ï¼Œéœ€è¦ä¿è¯26.4 MB/s çš„ä¸Šä¼ é€Ÿåº¦ï¼Œä¸æ¸…æ¥šè¿™ä¼šä¸ä¼šå¯¼è‡´è¿‡åº¦å ç”¨ç½‘å¡ï¼Œå¯¼è‡´æ¸¸æˆè¿›ç¨‹æ‰åŒ…

æœ¬åœ°ä¸¤å° PC ä¹‹é—´çš„ä¼ è¾“æ—¶å»¶ä½äº 1msï¼Œ å¯¹äºæœ¬åº”ç”¨å¯ä»¥å¿½ç•¥ä¸è®¡
æˆ‘ä»¬è€ƒè™‘æ¯ä¸€å¸§çš„æƒ…å†µ
$$
data = \frac{1  \times 320 \times 320 \times 24}{8} =  307,200(B/frame)=300(KB/frame) = 0.293(MB/frame)
$$
ä¼ è¾“æ–¹æ³•
```c++
// send
 Mat img = imread("img/1.jpg");
int imgSize = img.cols*img.rows*img.channels();
char *pos = (char*)img.data;
int total = 0;
while (total < imgSize)
{
    int sizelen = send(sockfd, pos+total, imgSize-total, 0);
    total = total + sizelen;
}
// recieve
 if ((connfd = accept(listenfd, (struct sockaddr*)NULL, NULL)) == -1)
{
    printf("accept socket error: %s(errno: %d)",strerror(errno),errno);
}
char buf[320 * 320 * 3]; // å›¾ç‰‡å®½é«˜
memset(buf, 0, sizeof(buf));
int total = 0;
while(total < 320 * 320 * 3)
{
    long len = recv(connfd, buf+total, 320 * 320 * 3-total, 0); // æ³¨æ„åç§»é‡
    total = total + len;
}
cout << "æ¥æ”¶é•¿åº¦ä¸º: " << total << endl;
Mat img(320 * 320, CV_8UC3, buf);
```

åœ¨å¼€å§‹å¼€å‘ä¹‹å‰éœ€è¦æµ‹è¯•**ç½‘ç»œå’Œæ€§èƒ½ç“¶é¢ˆ**
æ—¶å»¶è®¡ç®—
$$
timeDelay = grabTime + cropTime + TransportTime_1 + InferenceTime + TransportTime_2
$$

ä½¿ç”¨ä¸€ä¸ªZeroMQ çš„å¤´æ–‡ä»¶onlyç‰ˆæœ¬å°±è¡Œäº†ï¼ˆéå¸¸æ–¹ä¾¿ï¼‰
è¿™æ ·å°±èƒ½å•æœºè¿è¡Œå’Œå¤šæœºè¿è¡Œäº†ï¼ˆè®¾ç½®å¯åŠ¨è„šæœ¬å³å¯ï¼‰
tips:
1. cppzmq åªæ˜¯ä¸€ä¸ª c++ çš„wrapperï¼Œå…¶æœ¬è´¨è¿˜æ˜¯ åŸºäºc çš„libzmq
2. ä½¿ç”¨cppzmq éœ€è¦å…ˆç¼–è¯‘ libzmqï¼Œå¹¶ä¸”å°† libzmq/include/zmq.h å’Œ cppzmq/* æ·»åŠ åˆ°åŒ…å«ç›®å½•
3. å°† libzmq/\<build_dir\>/lib/æ·»åŠ åˆ°åº“ç›®å½•
4. å°†ä»¥ä¸‹æ–‡ä»¶ä½œä¸ºé“¾æ¥å™¨è¾“å…¥
    wsock32.lib
    ws2_32.lib
    Iphlpapi.lib
    libzmq-v143-mt-s-4_3_5.lib
    libzmq-v143-mt-4_3_5.exp
    testutil.lib
    testutil-static.lib
    unity.lib

ç»è¿‡æµ‹è¯•ï¼Œä½¿ç”¨ cppzmq åœ¨æœ¬åœ°è®¡ç®—æœºèƒ½å®Œæˆ 1ms å†…çš„æ•°æ®ä¼ è¾“ï¼Œç›®æ ‡æ•°æ®çš„ä¼ è¾“éœ€è¦ä½¿ç”¨ json è¿›è¡Œåºåˆ—åŒ–ï¼
